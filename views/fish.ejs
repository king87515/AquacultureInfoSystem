<!doctype html>
<html lang="en">

<head>
	<title>Dashboard</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<!-- VENDOR CSS -->
	<link rel="stylesheet" type="text/css" href="assets/scripts/jquery-ui-1.12.1.custom/jquery-ui.css">
	<link rel="stylesheet" type="text/css" href="assets/scripts/jquery-ui-1.12.1.custom/jquery-ui.theme.min.css">
	<link rel="stylesheet" type="text/css" href="assets/scripts/jquery-ui-1.12.1.custom/jquery-ui.structure.min.css" />

	<link type="text/css" rel="stylesheet" href="assets/scripts/jsgrid-1.5.3/jsgrid.min.css" />
	<link type="text/css" rel="stylesheet" href="assets/scripts/jsgrid-1.5.3/jsgrid-theme.min.css" />

	<script type="text/javascript" src="assets/scripts/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="assets/scripts/jquery-ui-1.12.1.custom/external/jquery/jquery.js"></script>
	<script type="text/javascript" src="assets/scripts/jquery-ui-1.12.1.custom/jquery-ui.js"></script>

	<script type="text/javascript" src="assets/scripts/jsgrid-1.5.3/jsgrid.min.js"></script>

	<script type="text/javascript" src="assets/scripts/daterangepicker-master/moment.min.js"></script>
	<script type="text/javascript" src="assets/scripts/daterangepicker-master/daterangepicker.js"></script>
	<link type="text/css" rel="stylesheet" href="assets/scripts/daterangepicker-master/daterangepicker.css" />

	<link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/vendor/linearicons/style.css">
	<link rel="stylesheet" href="assets/vendor/chartist/css/chartist-custom.css">
	<!-- MAIN CSS -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
	<link rel="stylesheet" href="assets/css/demo.css">
	<!-- GOOGLE FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
	<!-- ICONS -->
	<link rel="apple-touch-icon" sizes="76x76" href="assets/img/icon.png">
	<link rel="icon" type="image/png" sizes="96x96" href="assets/img/icon.png">

	<link rel="stylesheet" type="text/css" href="assets/d3script/scatterplot-tour/inspector.css">

	<script type="text/javascript" src="js/script/fish.js"></script>

	<script src="assets/scripts/Chart.js-2.9.4/dist/Chart.js" charset="utf-8"></script>
	<script type="text/javascript" src="assets/scripts/html2canvas.min.js"></script>

	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="assets/css/dc.css" />
	<script type="text/javascript" src="assets/scripts/d3.v6.min.js"></script>
	<script type="text/javascript" src="assets/scripts/crossfilter.min.js"></script>
	<script type="text/javascript" src="assets/scripts/dc.min.js"></script>
</head>

<body>
	<!-- WRAPPER -->

	<div id="wrapper">
		<!-- NAVBAR -->
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="brand">
				<a href="index.ejs"><img src="assets/img/logo.png" alt="Klorofil Logo" width="140px"
						class="img-responsive logo"></a>
			</div>
			<div class="container-fluid">
				<!-- USER BAR -->
				<div id="Header" style="padding-top: 1%;">
					<ul style="float: right!important; height: 40px">
						<li style="float: left; display: block; position: relative; margin-right: 10px;">
							<%= user.userName %>
						</li>
						<li style="float: left; display: block; position: relative; margin-right: 20px;"> 您好 !</li>
						<li style="float: left; display: block; position: relative; margin-right: 10px;">
							<a href="/logout" a class="btn btn-primary"
								style="height: 28px; font-size: 12px; margin-left:5px; margin-top:-5px; line-height:1;">登出</a>
						</li>
					</ul>
				</div>
				<!-- END USER BAR -->
				<div class="navbar-btn">
					<button type="button" class="btn-toggle-fullwidth"><i
							class="lnr lnr-arrow-left-circle"></i></button>
				</div>
				<div id="navbar-menu">
				</div>
			</div>
		</nav>
		<!-- END NAVBAR -->
		<!-- LEFT SIDEBAR -->
		<div id="sidebar-nav" class="sidebar">
			<div class="sidebar-scroll">
				<nav>
					<ul class="nav">
						<li><a class=""><i></i><span></span></a></li>
						<li><a href="fish.ejs" class="active"><i class="lnr lnr-home"></i><span>魚隻測量資料分析</span></a>
						</li>
						<li><a href="analysis.ejs" class=""><i class="lnr lnr-chart-bars"></i><span>LNG廠水質資料</span></a></li>
						<li><a href="statistics.ejs" class=""><i class="lnr lnr-dice"></i><span>LNG廠投餌資料</span></a>
						</li>
						<li><a href="waterquality.ejs" class=""><i class="lnr lnr-drop"></i><span>恆春箱網水質資訊</span></a>
						</li>
						<!-- <li><a href="analysis_record.ejs" class=""><i class="lnr lnr-code"></i><span>聲納資料</span></a>
						</li>  -->
						<li><a href="a13.ejs" class=""><i class="lnr lnr-drop"></i><span>a13水質資訊</span></a>
						</li>
						<li><a href="downloads.ejs" class=""><i class="lnr lnr-code"></i><span>資料下載(csv)</span></a>
						</li>  
						<li><a href="vr.ejs" target="_blank" class=""><i class="fa fa-cubes"></i><span>VR編輯模擬平台</span></a>
						</li>
						<li>
							<a href="#subPages" data-toggle="collapse" class="collapsed"><i class="lnr lnr-file-empty"></i> <span>資料庫編輯</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
							<div id="subPages" class="collapse ">
								<ul class="nav">
									<li><a href="fish_edit.ejs" class="">魚隻資料</a></li>
									<li><a href="analysis_edit.ejs" class="">LNG廠水質資料</a></li>
									<li><a href="statistics_edit.ejs" class="">LNG廠投餌資料</a></li>
									<li><a href="waterquality_edit.ejs" class="">恆春箱網水質資料</a></li>
									<li><a href="a13_edit.ejs" class="">a13水質資料</a></li>
								</ul>
							</div>
						</li>
					</ul>
				</nav>
			</div>
		</div>
		<!-- END LEFT SIDEBAR -->
		<!-- MAIN -->
		<div class="main">
			<!-- MAIN CONTENT -->
			<div class="main-content">
				<div class="container-fluid">
					<h3 class="page-title">魚隻測量資料分析</h3>
					<div class="row">
						<div class="col-md-12">
							<div class="panel">
								
								<!-- <div class="panel-heading">
									<h3 class="panel-title">使用者自定義門檻</h3>
								</div> -->
	
								<div class="panel-heading">
									<h3 class="panel-title">搜尋</h3>
								</div>
								<div class="panel-body" id="thresholdUI">
									<div class="row">
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">池號</span>
												<input id="text_Cage_no" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Cage_no">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->	
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">樣本編號</span>
												<input id="text_Sample_no" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Sample_no">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->	
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">物種</span>
												<input id="text_Specie" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Specie">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->			
									</div><!-- /.row -->
								</div>
							
							
								<div class="panel-body" id="thresholdUI">
									<div class="row">
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">體高(公分)</span>
												<input id="text_Body_height" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Body_height">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->		
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">體寬(公分)</span>
												<input id="text_Body_width" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Body_width">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">尾叉長(公分)</span>
												<input id="text_Body_len" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Body_len">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->		
									</div><!-- /.row -->
								</div>

								<div class="panel-body" id="thresholdUI">
									<div class="row">
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">尾柄高(公分)</span>
												<input id="text_Tail_height" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Tail_height">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->		
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">眼徑(公分)</span>
												<input id="text_Eye_radius" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Eye_radius">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->
										<div class="col-lg-3">
											<div class="input-group">
												<span class="input-group-addon" id="basic-addon3">重量(克)</span>
												<input id="text_Weight" type="text" class="form-control" aria-label="...">
												<span class="input-group-btn">
													<button class="btn btn-primary" type="button"
														id="set_text_Weight">設定</button>
												</span>
											</div><!-- /input-group -->
										</div><!-- /.col-lg-3 -->		
									</div><!-- /.row -->
								</div>
							
							
								<div class="panel-body">
									<div class="input-group">
										<input class="form-control" placeholder="起訖時間:    年/月/日  ~  年/月/日" type="text"
											id="search_text_fish_record">
										<span class="input-group-btn">
											<button class="btn btn-primary" type="button"
													id="search_fish_record">搜尋</button>
											<button class="btn btn-warning" type="button" style="margin-left: 5px;"
												id="search_clean_fish_record">清除</button>
										</span>
									</div>
								</div>

							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<!-- BUTTONS -->
							<div class="panel">
								<div class="panel-heading">
									<h3 class="panel-title">所有魚隻測量參數(包含海外箱網及LNG廠)</h3>
								</div>
								<!-- <p class="panel-subtitle">Period: Oct 14, 2016 - Oct 21, 2016</p> -->
								<div class="row">
									<div class="col-md-2" style="margin-left: 3%;">
										<button class="btn btn-primary" type="button"
										id="export_csv">匯出Excel</button>
									</div>
								</div>
								<div class="panel-body">
									<div class="panel-body">
										<div id="statistics_fish_record"
											style="position: relative; height: auto; width: 100%;">
											<div class="jsgrid-grid-header jsgrid-header-scrollbar">
												<table class="jsgrid-table">
													<tbody>
														<tr class="jsgrid-header-row">
															<th style="width: 100px;"
																class="jsgrid-header-cell jsgrid-header-sortable">NULL
															</th>
															<th style="width: 150px;"
																class="jsgrid-header-cell jsgrid-header-sortable">NULL
															</th>
															<th style="width: 50px;"
																class="jsgrid-header-cell jsgrid-align-center jsgrid-header-sortable">
																NULL</th>
															<th style="width: 50px;"
																class="jsgrid-header-cell jsgrid-align-right jsgrid-header-sortable">
																NULL</th>
														</tr>
														<tr class="jsgrid-filter-row" style="display: none;">
															<td style="width: 100px;" class="jsgrid-cell"><input
																	type="text">
															</td>
															<td style="width: 150px;" class="jsgrid-cell"><input
																	type="text">
															</td>
															<td style="width: 50px;"
																class="jsgrid-cell jsgrid-align-center">
																<input type="number">
															</td>
															<td style="width: 50px;"
																class="jsgrid-cell jsgrid-align-right">
																<input type="number">
															</td>
														</tr>
														<tr class="jsgrid-insert-row" style="display: none;">
															<td style="width: 100px;" class="jsgrid-cell"><input
																	type="text">
															</td>
															<td style="width: 150px;" class="jsgrid-cell">
																<textarea></textarea>
															</td>
															<td style="width: 50px;"
																class="jsgrid-cell jsgrid-align-center">
																<input type="number">
															</td>
															<td style="width: 50px;"
																class="jsgrid-cell jsgrid-align-right">
																<input type="number">
															</td>
														</tr>
													</tbody>
												</table>
											</div>
											<div class="jsgrid-grid-body">
												<table class="jsgrid-table">
													<tbody>
														<tr class="jsgrid-nodata-row">
															<td class="jsgrid-cell" colspan="4">Not found</td>
														</tr>
													</tbody>
												</table>
											</div>
											<div class="jsgrid-pager-container" style="display: none;"></div>
											<div class="jsgrid-load-shader"
												style="position: absolute; inset: 0px; z-index: 1000;"></div>
											<div class="jsgrid-load-panel"
												style="position: absolute; top: 50%; left: 50%; z-index: 1000; margin-top: -35px; margin-left: -105px;">
												Please wait...</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-7">
								<div class="panel" id="panel1">
									<div class="panel-heading">
										<div class="panel-body" id="panel-body"></div>
									</div>
								</div>
							</div>
							<div class="col-md-5">
								<div class="panel" id="panel2">
									<div class="panel-body">
										<label for="LNGfishbodychart_x">選擇 X 軸:</label>
										<select name="LNGfishbodychart_x" id="LNGfishbodychart_x">
											<option value="Body_height">體高(公分)</option>
											<option value="Body_width" selected>體寬(公分)</option>
											<option value="Body_len">尾叉長(公分)</option>
											<option value="Tail_height">尾柄高(公分)</option>
											<option value="Eye_radius">眼徑(公分)</option>
											<option value="Weight">重量(克)</option>
										</select>
										<label style="margin-left: 20px;" for="LNGfishbodychart_y">選擇 Y 軸:</label>
										<select name="LNGfishbodychart_y" id="LNGfishbodychart_y">
											<option value="Body_height">體高(公分)</option>
											<option value="Body_width">體寬(公分)</option>
											<option value="Body_len">尾叉長(公分)</option>
											<option value="Tail_height">尾柄高(公分)</option>
											<option value="Eye_radius">眼徑(公分)</option>
											<option value="Weight" selected>重量(克)</option>
										</select>
										<button style="margin-left: 20px;" type="button" id="LNGfishbodychartbutton"
											class="btn btn-primary btn-xs">確定</button>
									</div>
									<div class="panel-body">
										<canvas id="LNGfishbodychart"></canvas>
									</div>
								</div>
							</div>
						</div>
						<!-- <div id="canvasImg"></div> -->
					</div>
				</div>
			</div>
			<div class="clearfix"></div>
			<footer>
				<div class="container-fluid">
					<p class="copyright">&copy; 2021 <a href="https://www.themeineed.com" target="_blank">Theme I
							Need</a>.
						All Rights Reserved.</p>
				</div>
			</footer>
		</div>
		<!-- END WRAPPER -->
		<!-- Javascript -->
		<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
		<script src="assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
		<script src="assets/vendor/jquery.easy-pie-chart/jquery.easypiechart.min.js"></script>
		<script src="assets/vendor/chartist/js/chartist.min.js"></script>
		<script src="assets/scripts/klorofil-common.js"></script>
		<script type="module">
			import { Runtime, Library, Inspector } from "./assets/d3script/scatterplot-tour/runtime.js";

			//D3.js ex1
			// import define from "./assets/d3script/scatterplot-tour/d3_ex1.js";
			// const runtime = new Runtime();
			// const main = runtime.module(define, Inspector.into(document.getElementById("panel-body-second")));

			//D3.js ex2
			import define_second from "./assets/d3script/scatterplot-matrix/d3_ex2.js";
			const runtime_second = new Runtime();
			const main_second = runtime_second.module(define_second, Inspector.into(document.getElementById("panel-body")));

			var elems = document.getElementsByClassName("observablehq");
			let clearElems = [];
			var attr = [1, 2];	// , 15, 17];
			for (var i = 0; i < elems.length; i += 1) {
				if (!attr.includes(i)){
					elems[i].style.display = 'none';
					clearElems.push(elems[i]);
				}
			}
			clearElems.forEach(box => {
				box.remove();
			});

			
			setTimeout(handleSvgToCanvas,1000);
			// await handleSvgToCanvas();
			function handleSvgToCanvas() {
				var svgElem = document.getElementsByTagName("svg");
				[].forEach.call(svgElem, function(node) {
					// console.log(node);
					// console.log(node.parentNode);

					let parentElement = node.parentNode;
					const img = new Image();
					//make svg convert to base64 img, then make img convert to canvas
					img.src = `data:image/svg+xml,${encodeURIComponent(
						new XMLSerializer().serializeToString(node)
					)}`; // `str` vs 'str' : https://developer.mozilla.org/zh-TW/docs/Learn/JavaScript/First_steps/Strings
					// console.log("img.src:",img.src);
					img.crossOrigin = "anonymous";
					// console.log("img:",img);
					img.onload = function () {
						// console.log("img.onload");

						// get svg width&height，onload is an async fun.
						const width = node.getBoundingClientRect().width;
						const height = node.getBoundingClientRect().height;
						const canvas = document.createElement("canvas");
						canvas.width = width;
						canvas.height = height;
						const ctx = canvas.getContext("2d");
						ctx.drawImage(img, 0, 0, width, height);
						// console.log(canvas);
						let cvs = parentElement.appendChild(canvas);
						// cvs.style.display = 'none';
						cvs.setAttribute("id", "DivD3");
						// 删除之前的svg和圖片，只保留canvas
						// parentElement.removeChild(node);
						parentElement.removeChild(img);

						//隱藏svg
						node.style.display = 'none';

					};
					parentElement.append(img);
				});
			}
		</script>
</body>

</html>